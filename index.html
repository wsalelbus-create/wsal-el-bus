<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="Live bus tracker for ETUSA Algiers with real-time countdowns">
    <meta name="theme-color" content="#00d2ff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="ŸàÿµŸÑ ÿßŸÑÿ®ÿßÿµ">
    <meta name="mobile-web-app-capable" content="yes">

    <title>ŸàÿµŸÑ ÿßŸÑÿ®ÿßÿµ - Wsal El Bus</title>

    <!-- PWA Manifest -->
    <link rel="manifest" href="./manifest.webmanifest">

    <!-- Stylesheets -->
    <link rel="stylesheet" href="./styles.css">
    <link rel="stylesheet" href="./pwa-mobile.css">
    <link rel="stylesheet" href="./station-modal.css">
    <link rel="stylesheet" href="./version-footer.css">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="./leaflet.css" />

    <!-- Icons -->
    <link rel="icon" type="image/png" sizes="16x16" href="./images/icon16.png">
    <link rel="icon" type="image/png" sizes="48x48" href="./images/icon48.png">
    <link rel="icon" type="image/png" sizes="128x128" href="./images/icon128.png">
    <link rel="icon" type="image/png" sizes="192x192" href="./images/icon192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="./images/icon512.png">
    <link rel="apple-touch-icon" href="./images/icon192.png">
</head>

<body>
    <div class="app-container">
        <header class="glass-header">
            <div class="logo-area">
                <h1 class="arabic-title">ŸàÿµŸÑ ÿßŸÑÿ®ÿßÿµ</h1>
                <span class="live-badge">LIVE</span>
            </div>
            <div class="time-display" id="algiers-time">--:--</div>
        </header>

        <main>
            <section class="station-card glass-panel">
                <div class="slider-container">
                    <!-- Slide 1: Station Image -->
                    <div class="slide active" id="slide-image">
                        <div class="station-image-container">
                            <img src="images/station_placeholder.png" alt="Station" id="current-station-img"
                                class="station-img">
                            <div class="station-overlay">
                                <h2 id="station-name">Loading Station...</h2>
                                <p id="station-address" class="address"><span class="icon">üìç</span> <span
                                        id="addr-text">Locating...</span></p>
                            </div>
                        </div>
                    </div>

                    <!-- Slide 2: Map View -->
                    <div class="slide" id="slide-map">
                        <div id="map-container"></div>
                        <div class="map-overlay">
                            <h2 id="map-station-name">Loading...</h2>
                            <p class="map-distance" id="map-distance">üìç Calculating distance...</p>
                        </div>
                    </div>

                    <!-- Slider Navigation Dots -->
                    <div class="slider-dots">
                        <span class="dot active" data-slide="0"></span>
                        <span class="dot" data-slide="1"></span>
                    </div>
                </div>
            </section>

            <section class="routes-container">
                <!-- Walking Time Indicator -->
                <div class="walking-time" id="walking-time">
                    <span class="walk-icon">üö∂</span>
                    <span id="walk-time-text">Calculating...</span>
                </div>

                <h3>Next Arrivals</h3>
                <div class="routes-list" id="routes-list">
                    <!-- Route items will be injected here -->
                    <div class="loading-spinner"></div>
                </div>
            </section>
        </main>

        <!-- Station Selector Modal -->
        <div id="station-modal" class="modal-overlay hidden">
            <div class="modal-content glass-panel">
                <div class="modal-header">
                    <h3>Select Station</h3>
                    <button id="close-modal" class="close-btn">‚úï</button>
                </div>
                <input type="text" id="station-search" class="station-search" placeholder="Search stations...">
                <div class="station-list" id="station-list">
                    <!-- Station items will be injected here -->
                </div>
            </div>
        </div>

        <footer class="glass-footer">
            <button id="btn-nearest" class="nav-btn active">Nearest</button>
            <button id="btn-list" class="nav-btn">All Stations</button>
        </footer>

        <!-- Version Footer -->
        <div class="version-footer">
            <div class="version-text">Wsal El Bus 1.30a</div>
            <div class="tagline">Made with ‚ù§Ô∏è for Algiers commuters</div>
        </div>
    </div>

    <!-- Install Prompt (hidden by default) -->
    <div id="install-prompt" class="install-prompt hidden">
        <div class="install-content">
            <p>üì± Install Wsal El Bus for quick access!</p>
            <button id="install-btn" class="install-btn">Install</button>
            <button id="dismiss-btn" class="dismiss-btn">‚úï</button>
        </div>
    </div>

    <!-- Scripts -->
    <script src="leaflet.js"></script>
    <script src="app.js"></script>

    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./service-worker.js')
                    .then(registration => {
                        console.log('ServiceWorker registered:', registration.scope);
                    })
                    .catch(err => {
                        console.log('ServiceWorker registration failed:', err);
                    });
            });
        }

        // Install prompt handling
        let deferredPrompt;
        const installPrompt = document.getElementById('install-prompt');
        const installBtn = document.getElementById('install-btn');
        const dismissBtn = document.getElementById('dismiss-btn');

        window.addEventListener('beforeinstallprompt', (e) => {
            // Don't prevent default on mobile - let Chrome show "Install app" in menu
            // e.preventDefault();  // Commented out to allow native Chrome install
            deferredPrompt = e;
            installPrompt.classList.remove('hidden');
        });

        installBtn.addEventListener('click', async () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                console.log(`User response: ${outcome}`);
                deferredPrompt = null;
                installPrompt.classList.add('hidden');
            }
        });

        dismissBtn.addEventListener('click', () => {
            installPrompt.classList.add('hidden');
        });
    </script>
</body>

</html>
